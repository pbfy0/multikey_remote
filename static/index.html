<html>
<head>
<script src="/static/socket.io-1.4.5.js"></script>
<script>
	var socket = io(location.origin + '/key')
	var name = prompt('Name')
	socket.emit('hello', {name: name})
	var ui_map, g_map;
	socket.on('ack', function(val) {
		setTimeout(function() {
			socket.emit('get_maps')
			socket.on('maps', function(val) {
				ui_map = val.ui
				g_map = val.g
				window.addEventListener('keydown', function(ev) {
					ev.preventDefault()
					var vk = ev.keyCode
					if(vk in ui_map) socket.emit('keydown', {ui: true, mask: ui_map[vk]})
					if(vk in g_map) socket.emit('keydown', {ui: false, mask: g_map[vk]})
				})
				window.addEventListener('keyup', function(ev) {
					ev.preventDefault()
					var vk = ev.keyCode
					if(vk in ui_map) socket.emit('keyup', {ui: true, mask: ui_map[vk]})
					if(vk in g_map) socket.emit('keyup', {ui: false, mask: g_map[vk]})
				})
				window.addEventListener('beforeunload', function(ev) {
					socket.disconnect()
				})
			})
		}, 1000)
		/*window.addEventListener('beforeunload', function(ev) {
			socket.emit('dc')
		})*/
	})
</script>
</head>
<body>
</body>
</html>